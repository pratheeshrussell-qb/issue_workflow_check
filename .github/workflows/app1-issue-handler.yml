name: app1-issue-handler

on:
  workflow_dispatch:
    inputs:
      issue_number:
        required: true
permissions:
  contents: read
  issues: write
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    # passing body as input may have character limitations
      - name: Get issue details
        id: issue
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          issue=$(gh api repos/${{ github.repository }}/issues/${{ github.event.inputs.issue_number }})
          echo "issue_body=$(jq -c '[.body]' <<< "$issue")" >> $GITHUB_OUTPUT
        # body will be in md and has to be parsed
      - run: |
          echo "🏗️ Build triggered from Issue #${{ github.event.inputs.issue_number }}"
          echo "Title: ${{ github.event.inputs.issue_title }}"
          echo "Body: ${{ steps.issue.outputs.issue_body }}"
      - name: Comment and Close Issue
        run: |
          ISSUE_NUMBER="${{ github.event.inputs.issue_number }}"

          # Comment on the issue
          gh issue comment "$ISSUE_NUMBER" --body "Thanks for the report! This issue is now being closed. ✅"

          # Close the issue
          gh issue close "$ISSUE_NUMBER"
        env:
          GH_TOKEN: ${{ github.token }}
